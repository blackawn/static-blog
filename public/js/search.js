"use strict";document.addEventListener("DOMContentLoaded",()=>{if(!basicConfig.search.filePath)return void console.warn("hexo-generator-searchdb plugin is not installed!");let l,r=!1,c="",h;const d=document.querySelector(".search-text-x"),e=document.querySelector(".search-button"),p=(e,o,s=!1)=>{const i=[],a=new Set;return e.forEach(t=>{if(basicConfig.search.localSearch.unescape){const e=document.createElement("div");e.innerText=t,t=e.innerHTML}var r=t.length;if(0!==r){let e=0;var n;for(s||(o=o.toLowerCase(),t=t.toLowerCase());-1<(n=o.indexOf(t,e));)i.push({position:n,word:t}),a.add(t),e=n+r}}),i.sort((e,t)=>e.position!==t.position?e.position-t.position:t.word.length-e.word.length),[i,a]},g=(e,t,r)=>{var n=r[0];let{position:o,word:s}=n;const i=[],a=new Set;for(;o+s.length<=t&&0!==r.length;){a.add(s),i.push({position:o,length:s.length});var l=o+s.length;for(r.shift();0!==r.length&&(n=r[0],o=n.position,s=n.word,l>o);)r.shift()}return{hits:i,start:e,end:t,count:a.size}},m=(e,t)=>{let r="",n=t.start;for(var{position:o,length:s}of t.hits)r+=e.substring(n,o),n=o+s,r+=`<mark class="bg-pink-300 dark:text-coolGray-800">${e.substr(o,s)}</mark>`;return r+=e.substring(n,t.end),r},t=()=>{if(l&&c!==d.value.trim().toLowerCase()){const i=d.value.trim().toLowerCase();var r,n,o,s=i.split(/[-\s]+/);const a=document.querySelector(".search-result-wrap");let e=[],t;0<i.length&&(r=window.performance.now(),e=(e=>{const u=[];return h.forEach(({title:r,content:n,url:o})=>{var[s,i]=p(e,r),[a,l]=p(e,n),i=new Set([...i,...l]).size,l=s.length+a.length;if(0!==l){const d=[];0!==s.length&&d.push(g(0,r.length,s));let e=[];for(;0!==a.length;){var{position:c}=a[0],h=Math.max(0,c-20),c=Math.min(n.length,c+80);e.push(g(h,c,a))}e.sort((e,t)=>e.count!==t.count?t.count-e.count:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start);s=parseInt(basicConfig.search.localSearch.top_n_per_article,10);0<=s&&(e=e.slice(0,s));let t="";o=new URL(o,location.origin),0!==d.length?t+=`<li class="py-2 border-b border-dashed border-gray-500 first:pt-0 last:border-none dark:border-coolGray-500"><a href="${o.href}" class="text-lg hover:text-purple-500 dark:hover:text-purple-600">${m(r,d[0])}</a>`:t+=`<li class="py-2 border-b border-dashed border-gray-500 first:pt-0 last:border-none dark:border-coolGray-500"><a href="${o.href}" class="text-lg hover:text-purple-500 dark:hover:text-purple-600">${r}</a>`,e.forEach(e=>{t+=`<p class="mt-[.2rem]"><a href="${o.href}" class="text-sm hover:text-purple-500 dark:hover:text-purple-600">${m(n,e)}...</a></p>`}),t+="</li>",u.push({item:t,id:u.length,hitCount:l,includedCount:i})}}),u})(s),n=window.performance.now(),t=(n-r).toFixed(3)),1===s.length&&""===s[0]?a.innerHTML="":0===e.length?(a.innerHTML="",o=basicConfig.search.localSearch.i18n.empty.replace(/\$\{keywords}/,s),a.innerHTML=`<p class="px-4 py-3 text-sm"><ion-icon name="alert-circle-outline" class="mr-2 align-text-top text-lg text-yellow-600 darl:text-yellow-700"></ion-icon>${o}</p>`):(e.sort((e,t)=>e.includedCount!==t.includedCount?t.includedCount-e.includedCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id),o=basicConfig.search.localSearch.i18n.hits.replace(/\$\{hits}/,e.length),a.innerHTML=`<p class="px-4 py-3 text-sm"><ion-icon name="checkmark-circle-outline" class="mr-2 align-text-top text-lg text-green-600 dark:text-green-700"></ion-icon>${o}${basicConfig.search.localSearch.i18n.hits_time.replace(/\$\{time}/,t)}</p>
            
        <ul class="search-result-list max-h-[66vh] overflow-x-hidden overflow-y-auto px-4 pb-4 max-w-sm">${e.map(e=>e.item).join("")}</ul>`),c=i}};const n=()=>{d.placeholder=String(basicConfig.search.localSearch.i18n.placeholder),d.disabled=e.disabled=!1,e.classList.remove("cursor-not-allowed"),e.classList.add("group"),d.classList.remove("cursor-not-allowed"),e.addEventListener("click",t),d.addEventListener("input",t),d.addEventListener("keypress",e=>{"Enter"!==e.key&&e.key!==String.fromCharCode(13)||t()})},o=()=>{c="",document.querySelector(".search-result-wrap").innerHTML="",document.querySelector(".search-result-wrap").classList.toggle("hidden")};document.getElementById("maskCheckbox").addEventListener("input",()=>{l||!1!==r?o():((()=>{var e=basicConfig.webSize.rootPath+basicConfig.search.filePath;const t=!basicConfig.search.filePath.endsWith("json");fetch(e).then(e=>{if(e.ok)return r=!0,e.text();throw new Error("Network response was not ok.")}).then(e=>(h=t?[...(new DOMParser).parseFromString(e,"text/xml").querySelectorAll("entry")].map(e=>({title:e.querySelector("title").textContent,content:e.querySelector("content").textContent,url:e.querySelector("url").textContent})):JSON.parse(e),h=h.filter(e=>e.title).map(e=>(e.title=e.title.trim(),e.content=e.content?e.content.trim().replace(/<[^>]+>/g,""):"",e.url=decodeURIComponent(e.url).replace(/\/{2,}/g,"/"),e)),h)).then(e=>{e&&(l=!0,n())}).catch(e=>console.log(e))})(),window.addEventListener("keyup",e=>{"Escape"!==e.key&&e.key!==String.fromCharCode(27)||(document.getElementById("maskCheckbox").checked=!1,o())}))})});